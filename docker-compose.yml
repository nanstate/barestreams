services:
  redis:
    image: redis:7-alpine

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    environment:
      - LOG_LEVEL=info

  barestreams:
    build: .
    depends_on:
      redis:
        condition: service_started
      flaresolverr:
        condition: service_started
    command: ["sh", "-c", "sleep 5 && node dist/index.js"]
    ports:
      - "19080:80"
    environment:
      - REDIS_URL=redis://redis:6379
      - REDIS_TTL_HOURS=168
      - MAX_REQUEST_WAIT_SECONDS=15
      - EZTV_URL=https://eztv.re
      - YTS_URL=https://yts.lt
      - TGX_URL=https://torrentgalaxy.hair
      - APIBAY_URL=https://apibay.org
      - X1337X_URL=https://1337x.to
      - FLARESOLVERR_SESSIONS=10
      - FLARESOLVERR_URL=http://flaresolverr:8191
    volumes:
      - ./data/imdb:/app/data/imdb
